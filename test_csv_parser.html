<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV解析测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-case {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>CSV解析测试</h1>
    
    <div class="test-case">
        <h2>测试1: 基本CSV格式</h2>
        <pre id="test1-input">姓名,年龄,性别,是否完课_新,听课时长,互动参与率(参与度),客观题互动正确率,讲次
张三,10,男,是,30分钟,80%,90%,1
李四,11,女,否,25分钟,70%,85%,2</pre>
        <button onclick="runTest(1, document.getElementById('test1-input').textContent)">运行测试</button>
        <div id="test1-result" class="test-result"></div>
    </div>
    
    <div class="test-case">
        <h2>测试2: 带引号的CSV格式</h2>
        <pre id="test2-input">"姓名","年龄","性别","是否完课_新"
"张三","10","男","是"
"李四","11","女","否"
"王五","9","男","是"
"赵六","12","女","否"
"钱七","10","男","是"
"孙八","11","女","否"
"周九","9","男","是"
"吴十","12","女","否"
"郑十一","10","男","是"
"王十二","11","女","否"
"冯十三","9","男","是"
"陈十四","12","女","否"
"褚十五","10","男","是"
"卫十六","11","女","否"
"蒋十七","9","男","是"
"沈十八","12","女","否"
"韩十九","10","男","是"
"杨二十","11","女","否"
"朱二十一","9","男","是"
"秦二十二","12","女","否"
"尤二十三","10","男","是"
"许二十四","11","女","否"
"何二十五","9","男","是"
"吕二十六","12","女","否"
"施二十七","10","男","是"
"张二十八","11","女","否"
"孔二十九","9","男","是"
"曹三十","12","女","否"
"严三十一","10","男","是"
"华三十二","11","女","否"
"金三十三","9","男","是"
"魏三十四","12","女","否"
"陶三十五","10","男","是"
"姜三十六","11","女","否"
"戚三十七","9","男","是"
"谢三十八","12","女","否"
"邹三十九","10","男","是"
"喻四十","11","女","否"
"柏四十一","9","男","是"
"水四十二","12","女","否"
"窦四十三","10","男","是"
"章四十四","11","女","否"
"云四十五","9","男","是"
"苏四十六","12","女","否"
"潘四十七","10","男","是"
"葛四十八","11","女","否"
"奚四十九","9","男","是"
"范五十","12","女","否"
"彭五十一","10","男","是"
"郎五十二","11","女","否"
"鲁五十三","9","男","是"
"韦五十四","12","女","否"
"昌五十五","10","男","是"
"马五十六","11","女","否"
"苗五十七","9","男","是"
"凤五十八","12","女","否"
"花五十九","10","男","是"
"方六十","11","女","否"
"俞六十一","9","男","是"
"任六十二","12","女","否"
"袁六十三","10","男","是"
"柳六十四","11","女","否"
"酆六十五","9","男","是"
"鲍六十六","12","女","否"
"史六十七","10","男","是"
"唐六十八","11","女","否"
"费六十九","9","男","是"
"廉七十","12","女","否"
"岑七十一","10","男","是"
"薛七十二","11","女","否"
"雷七十三","9","男","是"
"贺七十四","12","女","否"
"倪七十五","10","男","是"
"汤七十六","11","女","否"
"滕七十七","9","男","是"
"殷七十八","12","女","否"
"罗七十九","10","男","是"
"毕八十","11","女","否"
"郝八十一","9","男","是"
"邬八十二","12","女","否"
"安八十三","10","男","是"
"常八十四","11","女","否"
"乐八十五","9","男","是"
"于八十六","12","女","否"
"时八十七","10","男","是"
"傅八十八","11","女","否"
"皮八十九","9","男","是"
"卞九十","12","女","否"
"齐九十一","10","男","是"
"康九十二","11","女","否"
"伍九十三","9","男","是"
"余九十四","12","女","否"
"元九十五","10","男","是"
"卜九十六","11","女","否"
"顾九十七","9","男","是"
"孟九十八","12","女","否"
"平九十九","10","男","是"
"黄一百","11","女","否"
"和一百零一","9","男","是"
"穆一百零二","12","女","否"
"萧一百零三","10","男","是"
"尹一百零四","11","女","否"
"姚一百零五","9","男","是"
"邵一百零六","12","女","否"
"湛一百零七","10","男","是"
"汪一百零八","11","女","否"
"祁一百零九","9","男","是"
"毛一百一十","12","女","否"
"禹一百一十一","10","男","是"
"狄一百一十二","11","女","否"
"米一百一十三","9","男","是"
"贝一百一十四","12","女","否"
"明一百一十五","10","男","是"
"臧一百一十六","11","女","否"
"计一百一十七","9","男","是"
"伏一百一十八","12","女","否"
"成一百一十九","10","男","是"
"戴一百二十","11","女","否"
"谈一百二十一","9","男","是"
"宋一百二十二","12","女","否"
"茅一百二十三","10","男","是"
"庞一百二十四","11","女","否"
"熊一百二十五","9","男","是"
"纪一百二十六","12","女","否"
"舒一百二十七","10","男","是"
"屈一百二十八","11","女","否"
"项一百二十九","9","男","是"
"祝一百三十","12","女","否"
"董一百三十一","10","男","是"
"梁一百三十二","11","女","否"
"杜一百三十三","9","男","是"
"阮一百三十四","12","女","否"
"蓝一百三十五","10","男","是"
"闵一百三十六","11","女","否"
"席一百三十七","9","男","是"
"季一百三十八","12","女","否"
"麻一百三十九","10","男","是"
"强一百四十","11","女","否"
"贾一百四十一","9","男","是"
"路一百四十二","12","女","否"
"娄一百四十三","10","男","是"
"危一百四十四","11","女","否"
"江一百四十五","9","男","是"
"童一百四十六","12","女","否"
"颜一百四十七","10","男","是"
"郭一百四十八","11","女","否"
"梅一百四十九","9","男","是"
"盛一百五十","12","女","否"
"林一百五十一","10","男","是"
"刁一百五十二","11","女","否"
"锺一百五十三","9","男","是"
"徐一百五十四","12","女","否"
"邱一百五十五","10","男","是"
"骆一百五十六","11","女","否"
"高一百五十七","9","男","是"
"夏一百五十八","12","女","否"
"蔡一百五十九","10","男","是"
"田一百六十","11","女","否"
"樊一百六十一","9","男","是"
"胡一百六十二","12","女","否"
"凌一百六十三","10","男","是"
"霍一百六十四","11","女","否"
"虞一百六十五","9","男","是"
"万一百六十六","12","女","否"
"支一百六十七","10","男","是"
"柯一百六十八","11","女","否"
"昝一百六十九","9","男","是"
"管一百七十","12","女","否"
"卢一百七十一","10","男","是"
"莫一百七十二","11","女","否"
"经一百七十三","9","男","是"
"房一百七十四","12","女","否"
"裘一百七十五","10","男","是"
"缪一百七十六","11","女","否"
"干一百七十七","9","男","是"
"解一百七十八","12","女","否"
"应一百七十九","10","男","是"
"宗一百八十","11","女","否"
"丁一百八十一","9","男","是"
"宣一百八十二","12","女","否"
"贲一百八十三","10","男","是"
"邓一百八十四","11","女","否"
"郁一百八十五","9","男","是"
"单一百八十六","12","女","否"
"杭一百八十七","10","男","是"
"洪一百八十八","11","女","否"
"包一百八十九","9","男","是"
"诸一百九十","12","女","否"
"左一百九十一","10","男","是"
"石一百九十二","11","女","否"
"崔一百九十三","9","男","是"
"吉一百九十四","12","女","否"
"钮一百九十五","10","男","是"
"龚一百九十六","11","女","否"
"程一百九十七","9","男","是"
"嵇一百九十八","12","女","否"
"邢一百九十九","10","男","是"
"滑二百","11","女","否"
"裴二百零一","9","男","是"
"陆荣二百零二","12","女","否"
"翁二百零三","10","男","是"
"荀二百零四","11","女","否"
"羊二百零五","9","男","是"
"於二百零六","12","女","否"
"惠二百零七","10","男","是"
"甄二百零八","11","女","否"
"麴二百零九","9","男","是"
"家二百一十","12","女","否"
"封二百一十一","10","男","是"
"芮二百一十二","11","女","否"
"羿二百一十三","9","男","是"
"储二百一十四","12","女","否"
"靳二百一十五","10","男","是"
"汲二百一十六","11","女","否"
"邴二百一十七","9","男","是"
"糜二百一十八","12","女","否"
"松二百一十九","10","男","是"
"井二百二十","11","女","否"
"段二百二十一","9","男","是"
"富二百二十二","12","女","否"
"巫二百二十三","10","男","是"
"乌二百二十四","11","女","否"
"焦二百二十五","9","男","是"
"巴二百二十六","12","女","否"
"弓二百二十七","10","男","是"
"牧二百二十八","11","女","否"
"隗二百二十九","9","男","是"
"山二百三十","12","女","否"
"谷二百三十一","10","男","是"
"车二百三十二","11","女","否"
"侯二百三十三","9","男","是"
"宓二百三十四","12","女","否"
"蓬二百三十五","10","男","是"
"全二百三十六","11","女","否"
"郗二百三十七","9","男","是"
"班二百三十八","12","女","否"
"仰二百三十九","10","男","是"
"秋二百四十","11","女","否"
"仲二百四十一","9","男","是"
"伊二百四十二","12","女","否"
"宫二百四十三","10","男","是"
"宁二百四十四","11","女","否"
"仇二百四十五","9","男","是"
"栾二百四十六","12","女","否"
"暴二百四十七","10","男","是"
"甘二百四十八","11","女","否"
"钭二百四十九","9","男","是"
"厉二百五十","12","女","否"
"戎二百五十一","10","男","是"
"祖二百五十二","11","女","否"
"武二百五十三","9","男","是"
"符二百五十四","12","女","否"
"刘二百五十五","10","男","是"
"景二百五十六","11","女","否"
"詹二百五十七","9","男","是"
"束二百五十八","12","女","否"
"龙二百五十九","10","男","是"
"叶二百六十","11","女","否"
"幸二百六十一","9","男","是"
"司二百六十二","12","女","否"
"韶二百六十三","10","男","是"
"郜二百六十四","11","女","否"
"黎二百六十五","9","男","是"
"蓟二百六十六","12","女","否"
"薄二百六十七","10","男","是"
"印二百六十八","11","女","否"
"宿二百六十九","9","男","是"
"白二百七十","12","女","否"
"怀二百七十一","10","男","是"
"蒲二百七十二","11","女","否"
"邰二百七十三","9","男","是"
"从二百七十四","12","女","否"
"鄂二百七十五","10","男","是"
"索二百七十六","11","女","否"
"咸二百七十七","9","男","是"
"籍二百七十八","12","女","否"
"赖二百七十九","10","男","是"
"卓二百八十","11","女","否"
"蔺二百八十一","9","男","是"
"屠二百八十二","12","女","否"
"蒙二百八十三","10","男","是"
"池二百八十四","11","女","否"
"乔二百八十五","9","男","是"
"阴二百八十六","12","女","否"
"郁二百八十七","10","男","是"
"胥二百八十八","11","女","否"
"能二百八十九","9","男","是"
"苍二百九十","12","女","否"
"双二百九十一","10","男","是"
"闻二百九十二","11","女","否"
"莘二百九十三","9","男","是"
"党二百九十四","12","女","否"
"翟二百九十五","10","男","是"
"谭二百九十六","11","女","否"
"贡二百九十七","9","男","是"
"劳二百九十八","12","女","否"
"逄二百九十九","10","男","是"
"姬三百","11","女","否"
"申三百零一","9","男","是"
"扶三百零二","12","女","否"
"堵三百零三","10","男","是"
"冉三百零四","11","女","否"
"宰三百零五","9","男","是"
"郦三百零六","12","女","否"
"雍三百零七","10","男","是"
"却三百零八","11","女","否"
"璩三百零九","9","男","是"
"桑三百一十","12","女","否"
"桂三百一十一","10","男","是"
"濮三百一十二","11","女","否"
"牛三百一十三","9","男","是"
"寿三百一十四","12","女","否"
"通三百一十五","10","男","是"
"边三百一十六","11","女","否"
"扈三百一十七","9","男","是"
"燕三百一十八","12","女","否"
"冀三百一十九","10","男","是"
"郏三百二十","11","女","否"
"浦三百二十一","9","男","是"
"尚三百二十二","12","女","否"
"农三百二十三","10","男","是"
"温三百二十四","11","女","否"
"别三百二十五","9","男","是"
"庄三百二十六","12","女","否"
"晏三百二十七","10","男","是"
"柴三百二十八","11","女","否"
"瞿三百二十九","9","男","是"
"阎三百三十","12","女","否"
"充三百三十一","10","男","是"
"慕三百三十二","11","女","否"
"连三百三十三","9","男","是"
"茹三百三十四","12","女","否"
"习三百三十五","10","男","是"
"宦三百三十六","11","女","否"
"艾三百三十七","9","男","是"
"鱼三百三十八","12","女","否"
"容三百三十九","10","男","是"
"向三百四十","11","女","否"
"古三百四十一","9","男","是"
"易三百四十二","12","女","否"
"慎三百四十三","10","男","是"
"戈三百四十四","11","女","否"
"廖三百四十五","9","男","是"
"庾三百四十六","12","女","否"
"终三百四十七","10","男","是"
"暨三百四十八","11","女","否"
"居三百四十九","9","男","是"
"衡三百五十","12","女","否"
"步三百五十一","10","男","是"
"都三百五十二","11","女","否"
"耿三百五十三","9","男","是"
"满三百五十四","12","女","否"
"弘三百五十五","10","男","是"
"匡三百五十六","11","女","否"
"国三百五十七","9","男","是"
"文三百五十八","12","女","否"
"寇三百五十九","10","男","是"
"广三百六十","11","女","否"
"禄三百六十一","9","男","是"
"阙三百六十二","12","女","否"
"东三百六十三","10","男","是"
"欧三百六十四","11","女","否"
"殳三百六十五","9","男","是"
"沃三百六十六","12","女","否"
"利三百六十七","10","男","是"
"蔚三百六十八","11","女","否"
"越三百六十九","9","男","是"
"夔三百七十","12","女","否"
"隆三百七十一","10","男","是"
"师三百七十二","11","女","否"
"巩三百七十三","9","男","是"
"厍三百七十四","12","女","否"
"聂三百七十五","10","男","是"
"晁三百七十六","11","女","否"
"勾三百七十七","9","男","是"
"敖三百七十八","12","女","否"
"融三百七十九","10","男","是"
"冷三百八十","11","女","否"
"訾三百八十一","9","男","是"
"辛三百八十二","12","女","否"
"阚三百八十三","10","男","是"
"那三百八十四","11","女","否"
"简三百八十五","9","男","是"
"饶三百八十六","12","女","否"
"空三百八十七","10","男","是"
"曾三百八十八","11","女","否"
"毋三百八十九","9","男","是"
"沙三百九十","12","女","否"
"乜三百九十一","10","男","是"
"养三百九十二","11","女","否"
"鞠三百九十三","9","男","是"
"须三百九十四","12","女","否"
"丰三百九十五","10","男","是"
"巢三百九十六","11","女","否"
"关三百九十七","9","男","是"
"蒯三百九十八","12","女","否"
"相三百九十九","10","男","是"
"查四百","11","女","否"
"后四百零一","9","男","是"
"荆四百零二","12","女","否"
"红四百零三","10","男","是"
"游四百零四","11","女","否"
"竺四百零五","9","男","是"
"权四百零六","12","女","否"
"逯四百零七","10","男","是"
"盖四百零八","11","女","否"
"益四百零九","9","男","是"
"桓四百一十","12","女","否"
"公四百一十一","10","男","是"
"仉四百一十二","11","女","否"
"督四百一十三","9","男","是"
"岳四百一十四","12","女","否"
"帅四百一十五","10","男","是"
"缑四百一十六","11","女","否"
"亢四百一十七","9","男","是"
"况四百一十八","12","女","否"
"郈四百一十九","10","男","是"
"有四百二十","11","女","否"
"琴四百二十一","9","男","是"
"归四百二十二","12","女","否"
"墨四百二十三","10","男","是"
"哈四百二十四","11","女","否"
"谯四百二十五","9","男","是"
"笪四百二十六","12","女","否"
"年四百二十七","10","男","是"
"爱四百二十八","11","女","否"
"阳四百二十九","9","男","是"
"佟四百三十","12","女","否"
"第五四百三十一","10","男","是"
"言四百三十二","11","女","否"
"福四百三十三","9","男","是"
"百四百三十四","12","女","否"
"家四百三十五","10","男","是"
"姓四百三十六","11","女","否"
"第437行","数据","测试","是"
"第438行","数据","测试","是"
"第439行","数据","测试","是"
"第440行","数据","测试","是"
"第441行","数据","测试","是"
"第442行","数据","测试","是"
"第443行","数据","测试","是"
"第444行","数据","测试","是"
"第445行","数据","测试","是"
"第446行","数据","测试","是"
"第447行","数据","测试","是"
"第448行","数据","测试","是"
"第449行","数据","测试","是"
"第450行","数据","测试","是"
"第451行","数据","测试","是"
"第452行","数据","测试","是"
"第453行","数据","测试","是"
"第454行","数据","测试","是"
"第455行","数据","测试","是"
"第456行","数据","测试","是"
"第457行","数据","测试","是"
"第458行","数据","测试","是"
"第459行","数据","测试","是"
"第460行","数据","测试","是"
"第461行","数据","测试","是"
"第462行","数据","测试","是"
"第463行","数据","测试","是"
"第464行","数据","测试","是"
"第465行","数据","测试","是"
"第466行","数据","测试","是"
"第467行","数据","测试","是"
"第468行","数据","测试","是"
"第469行","数据","测试","是"
"第470行","数据","测试","是"
"第471行","数据","测试","是"
"第472行","数据","测试","是"
"第473行","数据","测试","是"
"第474行","数据","测试","是"
"第475行","数据","测试","是"
"第476行","数据","测试","是"
"第477行","数据","测试","是"
"第478行","数据","测试","是"
"第479行","数据","测试","是"
"第480行","数据","测试","是"
"第481行","数据","测试","是"
"第482行","数据","测试","是"
"第483行","数据","测试","是"
"第484行","数据","测试","是"
"第485行","数据","测试","是"
"第486行","数据","测试","是"
"第487行","数据","测试","是"
"第488行","数据","测试","是"
"第489行","数据","测试","是"
"第490行","数据","测试","是"
"第491行","数据","测试","是"
"第492行","数据","测试","是"
"第493行","数据","测试","是"
"第494行","数据","测试","是"
"第495行","数据","测试","是"
"第496行","数据","测试","是"
"第497行","数据","测试","是"
"第498行","数据","测试","是"
"第499行","数据","测试","是"
"第500行","数据","测试","是"
"第501行","数据","测试","是"
"第502行","数据","测试","是"
"第503行","数据","测试","是"
"第504行","数据","测试","是"
"第505行","数据","测试","是"
"第506行","数据","测试","是"
"第507行","数据","测试","是"
"第508行","数据","测试","是"
"第509行","数据","测试","是"
"第510行","数据","测试","是"
"第511行","数据","测试","是"
"第512行","数据","测试","是"
"第513行","数据","测试","是"
"第514行","数据","测试","是"
"第515行","数据","测试","是"
"第516行","数据","测试","是"
"第517行","数据","测试","是"
"第518行","数据","测试","是"
"第519行","数据","测试","是"
"第520行","数据","测试","是"
"第521行","数据","测试","是"
"第522行","数据","测试","是"
"第523行","数据","测试","是"
"第524行","数据","测试","是"
"第525行","数据","测试","是"
"第526行","数据","测试","是"
"第527行","数据","测试","是"
"第528行","数据","测试","是"
"第529行","数据","测试","是"
"第530行","数据","测试","是"
"第531行","数据","测试","是"
"第532行","数据","测试","是"
"第533行","数据","测试","是"
"第534行","数据","测试","是"
"第535行","数据","测试","是"
"第536行","数据","测试","是"
"第537行","数据","测试","是"
"第538行","数据","测试","是"
"第539行","数据","测试","是"
"第540行","数据","测试","是"
"第541行","数据","测试","是"
"第542行","数据","测试","是"
"第543行","数据","测试","是"
"第544行","数据","测试","是"
"第545行","数据","测试","是"
"第546行","数据","测试","是"
"第547行","数据","测试","是"
"第548行","数据","测试","是"
"第549行","数据","测试","是"
"第550行","数据","测试","是"
"第551行","数据","测试","是"
"第552行","数据","测试","是"
"第553行","数据","测试","是"
"第554行","数据","测试","是"
"第555行","数据","测试","是"
"第556行","数据","测试","是"
"第557行","数据","测试","是"
"第558行","数据","测试","是"
"第559行","数据","测试","是"
"第560行","数据","测试","是"
"第561行","数据","测试","是"
"第562行","数据","测试","是"
"第563行","数据","测试","是"
"第564行","数据","测试","是"
"第565行","数据","测试","是"
"第566行","数据","测试","是"
"第567行","数据","测试","是"
"第568行","数据","测试","是"
"第569行","数据","测试","是"
"第570行","数据","测试","是"
"第571行","数据","测试","是"
"第572行","数据","测试","是"
"第573行","数据","测试","是"
"第574行","数据","测试","是"
"第575行","数据","测试","是"
"第576行","数据","测试","是"
"第577行","数据","测试","是"
"第578行","数据","测试","是"
"第579行","数据","测试","是"
"第580行","数据","测试","是"
"第581行","数据","测试","是"
"第582行","数据","测试","是"
"第583行","数据","测试","是"
"第584行","数据","测试","是"
"第585行","数据","测试","是"
"第586行","数据","测试","是"
"第587行","数据","测试","是"
"第588行","数据","测试","是"
"第589行","数据","测试","是"
"第590行","数据","测试","是"
"第591行","数据","测试","是"
"第592行","数据","测试","是"
"第593行","数据","测试","是"
"第594行","数据","测试","是"
"第595行","数据","测试","是"
"第596行","数据","测试","是"
"第597行","数据","测试","是"
"第598行","数据","测试","是"
"第599行","数据","测试","是"
"第600行","数据","测试","是"
"第601行","数据","测试","是"
"第602行","数据","测试","是"
"第603行","数据","测试","是"
"第604行","数据","测试","是"
"第605行","数据","测试","是"
"第606行","数据","测试","是"
"第607行","数据","测试","是"
"第608行","数据","测试","是"
"第609行","数据","测试","是"
"第610行","数据","测试","是"
"第611行","数据","测试","是"
"第612行","数据","测试","是"
"第613行","数据","测试","是"
"第614行","数据","测试","是"
"第615行","数据","测试","是"
"第616行","数据","测试","是"
"第617行","数据","测试","是"
"第618行","数据","测试","是"
"第619行","数据","测试","是"
"第620行","数据","测试","是"
"第621行","数据","测试","是"
"第622行","数据","测试","是"
"第623行","数据","测试","是"
"第624行","数据","测试","是"
"第625行","数据","测试","是"
"第626行","数据","测试","是"
"第627行","数据","测试","是"
"第628行","数据","测试","是"
"第629行","数据","测试","是"
"第630行","数据","测试","是"
"第631行","数据","测试","是"
"第632行","数据","测试","是"
"第633行","数据","测试","是"
"第634行","数据","测试","是"
"第635行","数据","测试","是"
"第636行","数据","测试","是"
"第637行","数据","测试","是"
"第638行","数据","测试","是"
"第639行","数据","测试","是"
"第640行","数据","测试","是"
"第641行","数据","测试","是"
"第642行","数据","测试","是"
"第643行","数据","测试","是"
"第644行","数据","测试","是"
"第645行","数据","测试","是"
"第646行","数据","测试","是"
"第647行","数据","测试","是"
"第648行","数据","测试","是"
"第649行","数据","测试","是"
"第650行","数据","测试","是"
"第651行","数据","测试","是"
"第652行","数据","测试","是"
"第653行","数据","测试","是"
"第654行","数据","测试","是"
"第655行","数据","测试","是"
"第656行","数据","测试","是"
"第657行","数据","测试","是"
"第658行","数据","测试","是"
"第659行","数据","测试","是"
"第660行","数据","测试","是"
"第661行","数据","测试","是"
"第662行","数据","测试","是"
"第663行","数据","测试","是"
"第664行","数据","测试","是"
"第665行","数据","测试","是"
"第666行","数据","测试","是"
"第667行","数据","测试","是"
"第668行","数据","测试","是"
"第669行","数据","测试","是"
"第670行","数据","测试","是"
"第671行","数据","测试","是"
"第672行","数据","测试","是"
"第673行","数据","测试","是"
"第674行","数据","测试","是"
"第675行","数据","测试","是"
"第676行","数据","测试","是"
"第677行","数据","测试","是"
"第678行","数据","测试","是"
"第679行","数据","测试","是"
"第680行","数据","测试","是"
"第681行","数据","测试","是"
"第682行","数据","测试","是"
"第683行","数据","测试","是"
"第684行","数据","测试","是"
"第685行","数据","测试","是"
"第686行","数据","测试","是"
"第687行","数据","测试","是"
"第688行","数据","测试","是"
"第689行","数据","测试","是"
"第690行","数据","测试","是"
"第691行","数据","测试","是"
"第692行","数据","测试","是"
"第693行","数据","测试","是"
"第694行","数据","测试","是"
"第695行","数据","测试","是"
"第696行","数据","测试","是"
"第697行","数据","测试","是"
"第698行","数据","测试","是"
"第699行","数据","测试","是"
"第700行","数据","测试","是"
"第701行","数据","测试","是"
"第702行","数据","测试","是"
"第703行","数据","测试","是"
"第704行","数据","测试","是"
"第705行","数据","测试","是"
"第706行","数据","测试","是"
"第707行","数据","测试","是"
"第708行","数据","测试","是"
"第709行","数据","测试","是"
"第710行","数据","测试","是"
"第711行","数据","测试","是"
"第712行","数据","测试","是"
"第713行","数据","测试","是"
"第714行","数据","测试","是"
"第715行","数据","测试","是"
"第716行","数据","测试","是"
"第717行","数据","测试","是"
"第718行","数据","测试","是"
"第719行","数据","测试","是"
"第720行","数据","测试","是"
"第721行","数据","测试","是"
"第722行","数据","测试","是"
"第723行","数据","测试","是"
"第724行","数据","测试","是"
"第725行","数据","测试","是"
"第726行","数据","测试","是"
"第727行","数据","测试","是"
"第728行","数据","测试","是"
"第729行","数据","测试","是"
"第730行","数据","测试","是"
"第731行","数据","测试","是"
"第732行","数据","测试","是"
"第733行","数据","测试","是"
"第734行","数据","测试","是"
"第735行","数据","测试","是"</pre>
        <button onclick="runTest(2, document.getElementById('test2-input').textContent)">运行测试</button>
        <div id="test2-result" class="test-result"></div>
    </div>
    
    <div class="test-case">
        <h2>测试3: 带分号分隔符的CSV格式</h2>
        <pre id="test3-input">姓名;年龄;性别;是否完课_新
张三;10;男;是
李四;11;女;否</pre>
        <button onclick="runTest(3, document.getElementById('test3-input').textContent)">运行测试</button>
        <div id="test3-result" class="test-result"></div>
    </div>
    
    <div class="test-case">
        <h2>测试4: 带制表符分隔符的CSV格式</h2>
        <pre id="test4-input">姓名	年龄	性别	是否完课_新
张三	10	男	是
李四	11	女	否</pre>
        <button onclick="runTest(4, document.getElementById('test4-input').textContent)">运行测试</button>
        <div id="test4-result" class="test-result"></div>
    </div>
    
    <div class="test-case">
        <h2>测试5: 带管道符分隔符的CSV格式</h2>
        <pre id="test5-input">姓名|年龄|性别|是否完课_新
张三|10|男|是
李四|11|女|否</pre>
        <button onclick="runTest(5, document.getElementById('test5-input').textContent)">运行测试</button>
        <div id="test5-result" class="test-result"></div>
    </div>
    
    <div class="test-case">
        <h2>测试6: 包含空字段的CSV格式</h2>
        <pre id="test6-input">姓名,年龄,性别,是否完课_新
张三,,男,是
李四,11,,否
王五,9,男,</pre>
        <button onclick="runTest(6, document.getElementById('test6-input').textContent)">运行测试</button>
        <div id="test6-result" class="test-result"></div>
    </div>
    
    <div class="test-case">
        <h2>测试7: 包含转义字符的CSV格式</h2>
        <pre id="test7-input">姓名,年龄,性别,是否完课_新
"张""三",10,男,是
"李\n四",11,女,否</pre>
        <button onclick="runTest(7, document.getElementById('test7-input').textContent)">运行测试</button>
        <div id="test7-result" class="test-result"></div>
    </div>
    
    <script>
        // 复制parseCsv函数到这里
        function parseCsv(csvText) {
            try {
                console.log('开始解析CSV文件');
                console.log('CSV内容长度:', csvText.length);
                console.log('CSV前500字符:', csvText.substring(0, 500) + '...');
                
                // 处理可能的BOM字符和空白字符
                csvText = csvText.trim().replace(/^\ufeff/, '');
                
                // 检测分隔符 - 更准确的算法
                function detectDelimiter(csv) {
                    // 常见分隔符
                    const delimiters = [',', ';', '\t', '|'];
                    // 计算每种分隔符在非引号内的出现次数
                    let bestDelimiter = ',';
                    let maxScore = 0;
                    
                    delimiters.forEach(delimiter => {
                        let count = 0;
                        let inQuotes = false;
                        let quoteChar = '"';
                        
                        for (let i = 0; i < csv.length; i++) {
                            const char = csv[i];
                            
                            // 处理引号
                            if ((char === '"' || char === "'") && (i === 0 || csv[i-1] !== '\\')) {
                                if (!inQuotes) {
                                    quoteChar = char;
                                    inQuotes = true;
                                } else if (char === quoteChar) {
                                    inQuotes = false;
                                }
                            }
                            
                            // 只计算非引号内的分隔符
                            if (char === delimiter && !inQuotes) {
                                count++;
                            }
                        }
                        
                        // 计算得分：出现次数越多越好，但要避免极端情况
                        const score = count;
                        if (score > maxScore && score > 0) {
                            maxScore = score;
                            bestDelimiter = delimiter;
                        }
                    });
                    
                    return bestDelimiter;
                }
                
                const delimiter = detectDelimiter(csvText);
                console.log('检测到的分隔符:', delimiter);
                
                // 解析CSV的函数 - 更健壮的实现
                function parseCSV(csv, delimiter) {
                    const lines = [];
                    let currentLine = [];
                    let currentField = '';
                    let inQuotes = false;
                    let quoteChar = '"';
                    let isEscaped = false;
                    
                    for (let i = 0; i < csv.length; i++) {
                        const char = csv[i];
                        const nextChar = csv[i + 1];
                        
                        // 处理转义字符
                        if (char === '\\' && !isEscaped) {
                            isEscaped = true;
                            continue;
                        }
                        
                        // 检测引号字符
                        if (!inQuotes && !isEscaped && (char === '"' || char === "'")) {
                            quoteChar = char;
                            inQuotes = true;
                        } else if (char === quoteChar && !isEscaped) {
                            if (inQuotes && nextChar === quoteChar) {
                                // 处理转义的引号
                                currentField += quoteChar;
                                i++;
                            } else {
                                inQuotes = !inQuotes;
                            }
                        } else if (char === delimiter && !inQuotes) {
                            // 字段分隔符
                            currentLine.push(currentField.trim());
                            currentField = '';
                        } else if ((char === '\n' || char === '\r') && !inQuotes) {
                            // 行结束
                            currentLine.push(currentField.trim());
                            // 过滤空行
                            const nonEmptyFields = currentLine.filter(field => field !== '');
                            if (nonEmptyFields.length > 0) {
                                lines.push(currentLine);
                            }
                            currentLine = [];
                            currentField = '';
                            // 跳过可能的\r\n组合
                            if (char === '\r' && nextChar === '\n') {
                                i++;
                            }
                        } else {
                            // 普通字符
                            currentField += char;
                        }
                        
                        // 重置转义标志
                        if (isEscaped) {
                            isEscaped = false;
                        }
                    }
                    
                    // 处理最后一行
                    if (currentField !== '' || currentLine.length > 0) {
                        currentLine.push(currentField.trim());
                        const nonEmptyFields = currentLine.filter(field => field !== '');
                        if (nonEmptyFields.length > 0) {
                            lines.push(currentLine);
                        }
                    }
                    
                    return lines;
                }
                
                // 解析CSV内容
                const parsedLines = parseCSV(csvText, delimiter);
                console.log('解析出行数:', parsedLines.length);
                
                if (parsedLines.length === 0) {
                    console.log('CSV文件为空');
                    return { headers: [], rows: [] };
                }
                
                // 解析表头 - 清理表头名称
                const headers = parsedLines[0].map(header => header.trim().replace(/^["']|['"]$/g, ''));
                console.log('解析出表头:', headers);
                
                const data = [];
                
                // 解析数据行
                for (let i = 1; i < parsedLines.length; i++) {
                    const line = parsedLines[i];
                    if (line.length === 0) continue;
                    
                    console.log('解析第', i, '行:', line);
                    
                    // 创建行对象
                    const row = {};
                    headers.forEach((header, index) => {
                        // 处理空字段和索引越界
                        let value = line[index] !== undefined ? line[index].trim() : '';
                        // 移除可能的引号
                        value = value.replace(/^["']|['"]$/g, '');
                        
                        // 尝试转换数据类型
                        if (value === '') {
                            row[header] = '';
                        } else if (!isNaN(value) && !isNaN(parseFloat(value))) {
                            // 检查是否为数字
                            row[header] = Number(value);
                        } else if (value.toLowerCase() === 'true') {
                            row[header] = true;
                        } else if (value.toLowerCase() === 'false') {
                            row[header] = false;
                        } else {
                            // 保留为字符串
                            row[header] = value;
                        }
                    });
                    data.push(row);
                    console.log('创建行对象:', row);
                }
                
                console.log('解析完成，共', data.length, '行数据');
                return { headers, rows: data };
            } catch (error) {
                console.error('CSV解析错误:', error);
                console.error('错误堆栈:', error.stack);
                // 提供更详细的错误信息
                return { 
                    headers: [], 
                    rows: [],
                    error: error.message 
                };
            }
        }
        
        function runTest(testNumber, csvText) {
            console.log(`运行测试${testNumber}...`);
            const resultDiv = document.getElementById(`test${testNumber}-result`);
            
            try {
                const result = parseCsv(csvText);
                
                if (result.error) {
                    resultDiv.innerHTML = `<p class="error">测试失败: ${result.error}</p>`;
                } else {
                    resultDiv.innerHTML = `
                        <p class="success">测试成功!</p>
                        <p><strong>表头:</strong> ${JSON.stringify(result.headers)}</p>
                        <p><strong>数据行数:</strong> ${result.rows.length}</p>
                        <p><strong>前3行数据:</strong></p>
                        <pre>${JSON.stringify(result.rows.slice(0, 3), null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">测试失败: ${error.message}</p>`;
                console.error(`测试${testNumber}错误:`, error);
            }
        }
    </script>
</body>
</html>